@if (entidad$ | async; as entidad) {
	<div class="container mx-auto p-6">
		<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
			<!-- Información General -->
			<div
				class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
				<div class="p-6">
					<div class="flex items-center mb-4">
						<div
							class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
							<i class="bi bi-building text-gray-600 text-lg"></i>
						</div>
						<h2 class="text-lg font-semibold text-gray-900">Información General</h2>
					</div>
					<div class="space-y-3">
						@for (item of getInfoGeneralItems(entidad); track item.label) {
							<div class="flex justify-between items-center">
								<span
									class="text-sm font-medium text-gray-500 min-w-0 flex-shrink-0 mr-3">
									{{ item.label }}:
								</span>
								@if (item.type === 'badge') {
									<span
										class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
										[class]="item.class">
										@if (item.pipe === 'titlecase') {
											{{ item.value | titlecase }}
										} @else {
											{{ item.value }}
										}
									</span>
								} @else {
									<span
										class="text-sm text-gray-900 text-right"
										[class]="item.class || ''">
										@if (item.pipe === 'titlecase') {
											{{ item.value | titlecase }}
										} @else {
											{{ item.value }}
										}
									</span>
								}
							</div>
						}
					</div>
				</div>
			</div>

			<!-- Estadísticas -->
			<div
				class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
				<div class="p-6">
					<div class="flex items-center mb-4">
						<div
							class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
							<i class="bi bi-bar-chart text-gray-600 text-lg"></i>
						</div>
						<h2 class="text-lg font-semibold text-gray-900">Estadísticas</h2>
					</div>
					<div class="grid grid-cols-2 gap-4">
						@for (stat of getEstadisticasItems(entidad); track stat.label) {
							<div class="text-center">
								<div class="text-2xl font-bold text-gray-900">{{ stat.value }}</div>
								<div class="text-xs text-gray-500 mt-1">{{ stat.label }}</div>
							</div>
						}
					</div>
				</div>
			</div>

			<!-- Contacto -->
			<div
				class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200 md:col-span-2">
				<div class="p-6">
					<div class="flex items-center mb-6">
						<div
							class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
							<i class="bi bi-telephone text-gray-600 text-lg"></i>
						</div>
						<h2 class="text-lg font-semibold text-gray-900">
							Información de Contacto
						</h2>
					</div>
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
						<!-- Información Principal -->
						<div class="space-y-4">
							<h3
								class="text-sm font-medium text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
								Contacto Principal
							</h3>
							<div class="space-y-3">
								@for (
									contacto of getContactoPrincipalItems(entidad);
									track contacto.label
								) {
									<div class="flex items-center">
										<i class="bi {{ contacto.icon }} text-gray-400 mr-3 w-4"></i>
										<div>
											<div
												class="text-sm font-medium text-gray-900"
												[class]="contacto.class || ''">
												{{ contacto.value }}
											</div>
											<div class="text-xs text-gray-500">{{ contacto.label }}</div>
										</div>
									</div>
								}
							</div>
						</div>

						<!-- Teléfonos -->
						@if (entidad?.telefonos && entidad.telefonos.length) {
							<div class="space-y-4">
								<h3
									class="text-sm font-medium text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
									Teléfonos Adicionales
								</h3>
								<div class="space-y-3">
									@for (telefono of entidad.telefonos; track $index) {
										@let telefonoInfo = getTelefonoInfo(telefono);
										<div class="bg-gray-50 rounded-lg p-3 border border-gray-100">
											<div class="flex items-start justify-between">
												<div class="flex-1">
													<div class="text-sm font-medium text-gray-900">
														{{ telefonoInfo.numero }}
													</div>
													@if (telefonoInfo.tipo) {
														<div class="text-xs text-gray-500 mt-1">
															{{ telefonoInfo.tipo }}
														</div>
													}
													@if (telefonoInfo.observaciones) {
														<div class="text-xs text-gray-400 mt-1">
															{{ telefonoInfo.observaciones }}
														</div>
													}
												</div>
												@if (telefonoInfo.primario) {
													<span
														class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
														Principal
													</span>
												}
											</div>
										</div>
									}
								</div>
							</div>
						}

						<!-- Correos -->
						@if (entidad?.correos && entidad.correos.length > 0) {
							<div class="space-y-4">
								<h3
									class="text-sm font-medium text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
									Correos Electrónicos
								</h3>
								<div class="space-y-3">
									@for (correo of entidad.correos; track $index) {
										@let correoInfo = getCorreoInfo(correo);
										<div class="bg-gray-50 rounded-lg p-3 border border-gray-100">
											<div class="flex items-start justify-between">
												<div class="flex-1 min-w-0">
													<div class="text-sm font-medium text-gray-900 break-all">
														{{ correoInfo.email }}
													</div>
													@if (correoInfo.tipo) {
														<div class="text-xs text-gray-500 mt-1">
															{{ correoInfo.tipo }}
														</div>
													}
													@if (correoInfo.observaciones) {
														<div class="text-xs text-gray-400 mt-1">
															{{ correoInfo.observaciones }}
														</div>
													}
												</div>
												@if (correoInfo.primario) {
													<span
														class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 ml-2 flex-shrink-0">
														Principal
													</span>
												}
											</div>
										</div>
									}
								</div>
							</div>
						}
					</div>
				</div>
			</div>

			<!-- Líneas -->
			@if (lineas$ | async; as lineas) {
				<div
					class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200 md:col-span-2">
					<div class="p-6">
						<div class="flex items-center mb-6">
							<div
								class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
								<i class="bi bi-diagram-3 text-gray-600 text-lg"></i>
							</div>
							<h2 class="text-lg font-semibold text-gray-900">
								Líneas ({{ lineas.length }})
							</h2>
						</div>

						<!-- Grid de tarjetas de líneas -->
						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
							@for (linea of lineas; track linea.numero_linea) {
								<div
									class="bg-gray-50 rounded-lg border border-gray-200 hover:shadow-sm transition-shadow duration-200">
									<div class="p-4">
										<div class="flex items-center justify-between mb-3">
											<div class="flex items-center">
												<div
													class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold mr-3"
													[style.background-color]="linea.color_linea || '#6B7280'">
													{{ linea.numero_linea }}
												</div>
												<div>
													<div class="font-semibold text-gray-900">
														Línea {{ linea.numero_linea }}
													</div>
													<div class="text-xs text-gray-500">
														{{ linea.detalles.ramales.length || 0 }} ramales
													</div>
												</div>
											</div>
											<div class="flex items-center space-x-2">
												<button
													class="p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors duration-200"
													title="Ver detalles"
													(click)="abrirModalLinea(linea)">
													<i class="bi bi-eye text-sm"></i>
												</button>
											</div>
										</div>
									</div>
								</div>
							}
						</div>
					</div>
				</div>
			}

			<!-- Vehículos -->
			@if (vehiculos$ | async; as vehiculos) {
				<div class="md:col-span-2">
					<app-lista-vehiculos [vehiculos]="vehiculos"></app-lista-vehiculos>
				</div>
			}
		</div>
	</div>
}

<!-- Modal de detalles de línea -->
<app-modal-lineas
	[modalAbierto]="modalLineaAbierto"
	[lineaSeleccionada]="lineaSeleccionada"
	(cerrarModal)="cerrarModalLinea()">
</app-modal-lineas>
