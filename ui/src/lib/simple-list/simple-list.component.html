<!-- Barra superior con buscador, acciones y contador -->
<div class="flex justify-between items-center mb-4">
	<div class="flex flex-col gap-3">
		@if (showSearch()) {
			<label class="input">
				<i class="bi bi-search"></i>
				<input
					type="text"
					placeholder="Buscar..."
					[(ngModel)]="searchTerm"
					(input)="searchTerm.set($any($event.target).value)" />
			</label>
		} @else {
			<div></div>
		}
		<div class="text-sm text-accent px-1">
			@if (showPagination()) {
				Mostrando {{ startIndex() }} - {{ endIndex() }} de
				{{ filteredData().length }} registros
			}
		</div>
	</div>
	<!-- Acciones globales -->
	@if (globalActions()?.length) {
		<ul class="menu menu-horizontal rounded-box flex gap-3">
			@for (item of globalActions(); track $index) {
				<li [class]="item.info ? 'tooltip' : ''" *ngxPermissionsOnly="item.only">
					@if (item.info) {
						<div class="tooltip-content">
							{{ item.info }}
						</div>
					}
					<button
						style="height: inherit"
						class="btn p-2 border-none"
						(click)="item.action()">
						<i [class]="item.icon"></i>
						@if (item.label) {
							<p class="m-0 text-xs">
								{{ item.label }}
							</p>
						}
					</button>
				</li>
			}
		</ul>
	}
</div>

<div
	class="overflow-y-auto w-full mt-6"
	[class]="showPagination() ? 'h-[66vh]' : 'h-[75vh]'">
	<table
		[style.background-color]="backgroundColor()"
		class="table table-md rounded-none w-full table-fixed bg-base-100">
		<thead>
			<tr>
				@for (title of headers(); track $index) {
					<th class="text-center">{{ title }}</th>
				}
			</tr>
		</thead>
		<tbody>
			@for (ele of paginatedData(); track $index) {
				<tr>
					@for (data of dataKeys(); track $index) {
						<td class="text-center px-2">
							@switch (data.type) {
								<!--String-->
								@case (types.STRING) {
									<p class="truncate">
										{{ getValue(ele, data.key) | titlecase }}
									</p>
								}

								<!--Number-->
								@case (types.NUMBER) {
									<p class="truncate">
										{{ getValue(ele, data.key) }}
									</p>
								}
								<!--Date-->
								@case (types.DATE) {
									<p class="truncate">
										{{ getValue(ele, data.key) | date }}
									</p>
								}
								<!--Email-->
								@case (types.EMAIL) {
									<p
										class="cursor-pointer truncate"
										(click)="sendEmail(getValue(ele, data.key))">
										{{ getValue(ele, data.key) }}
									</p>
								}
								<!--Boolean-->
								@case (types.BOOLEAN) {
									<!--true case-->
									@if (getValue(ele, data.key) === data?.trueCase) {
										<i class="bi bi-check-lg"></i>
									} @else {
										<i class="bi bi-x-lg"></i>
									}
								}
							}
						</td>
					}
					@if (actions()?.length) {
						<td class="flex gap-4 items-center justify-center px-2">
							@for (item of actions(); track $index) {
								<!--Si existe condicion y se cumple-->
								@if (item.condition && item.condition(ele)) {
									<div class="tooltip">
										<div class="tooltip-content">
											{{ item.info }}
										</div>
										<button
											[disabled]="item.disabled || item?.disableCondition?.(ele)"
											style="height: inherit"
											class="btn p-1 bg-transparent border-none"
											(click)="item.action(ele)">
											<i [class]="item.icon"></i>
										</button>
									</div>
								}
								<!--Si no existe condicion-->
								@if (!item.condition) {
									<div class="tooltip">
										<div class="tooltip-content">
											{{ item.info }}
										</div>
										<button
											[disabled]="item.disabled || item?.disableCondition?.(ele)"
											style="height: inherit"
											class="btn p-1 bg-transparent border-none"
											(click)="item.action(ele)">
											<i [class]="item.icon"></i>
										</button>
									</div>
								}
							}
						</td>
					}
				</tr>
			}
		</tbody>
	</table>
</div>

<!-- Paginador -->
@if (showPagination() && totalPages() > 1) {
	<div class="flex justify-center items-center mt-4 gap-2">
		<!-- Botón anterior -->
		<button
			class="btn btn-sm btn-outline"
			[disabled]="currentPage() === 1"
			(click)="prevPage()">
			<i class="bi bi-chevron-left"></i>
		</button>

		<!-- Páginas -->
		@for (page of getVisiblePages(); track page) {
			<button
				class="btn btn-sm"
				[class.btn-primary]="page === currentPage()"
				[class.btn-outline]="page !== currentPage()"
				(click)="goToPage(page)">
				{{ page }}
			</button>
		}

		<!-- Botón siguiente -->
		<button
			class="btn btn-sm btn-outline"
			[disabled]="currentPage() === totalPages()"
			(click)="nextPage()">
			<i class="bi bi-chevron-right"></i>
		</button>
	</div>
}
